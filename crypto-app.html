<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</title>
  <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    /* –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å —É—á—ë—Ç–æ–º —Ç–µ–º—ã Telegram —á–µ—Ä–µ–∑ CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ */
    body {
      background-color: var(--tg-theme-bg-color);
      color: var(--tg-theme-text-color);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
      margin: 0;
      padding: 10px;
      /* –£—á–∏—Ç—ã–≤–∞–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã (notch) */
      padding-top: calc(10px + var(--tg-safe-area-inset-top, 0));
      padding-bottom: calc(10px + var(--tg-safe-area-inset-bottom, 0));
    }
    #chat {
      display: flex;
      flex-direction: column;
    }
    .message {
      max-width: 80%;
      padding: 8px 12px;
      margin: 5px;
      border-radius: 8px;
      word-break: break-word;
      opacity: 0; /* –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è */
    }
    .incoming {
      align-self: flex-start;
      background-color: var(--tg-theme-secondary-bg-color, #e0e0e0);
      color: var(--tg-theme-text-color);
      border-top-left-radius: 0; /* —É–±—Ä–∞—Ç—å —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–≥–æ –ª–µ–≤–æ–≥–æ —É–≥–ª–∞ */
    }
    .outgoing {
      align-self: flex-end;
      background-color: var(--tg-theme-button-color);
      color: var(--tg-theme-button-text-color);
      border-top-right-radius: 0; /* —É–±—Ä–∞—Ç—å —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤–µ—Ä—Ö–Ω–µ–≥–æ –ø—Ä–∞–≤–æ–≥–æ —É–≥–ª–∞ */
    }
    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π */
    .message.fade-in-left {
      animation: fadeInLeft 0.3s forwards;
    }
    .message.fade-in-right {
      animation: fadeInRight 0.3s forwards;
    }
    @keyframes fadeInLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    @keyframes fadeInRight {
      from { opacity: 0; transform: translateX(20px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
    .button {
      display: inline-block;
      background: var(--tg-theme-button-color);
      color: var(--tg-theme-button-text-color);
      border: none;
      padding: 6px 12px;
      margin: 4px 2px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      opacity: 0; /* –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—Ä–æ–∑—Ä–∞—á–Ω–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
    }
    .button.fade-in {
      animation: fadeIn 0.3s forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
    .input-field {
      margin: 4px 0;
      display: block;
      width: 90%;
      padding: 6px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    .input-group {
      margin: 8px 0;
    }
    /* –°—Ç–∏–ª—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è */
    #copy-notice {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
      opacity: 0;
      transition: opacity 0.3s;
    }
  </style>
</head>
<body>
  <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞ -->
  <div id="chat"></div>
  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ -->
  <div id="copy-notice">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ</div>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    const tg = window.Telegram.WebApp;
    if (tg) {
      tg.ready();
    }
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    let currentCipher = null;
    let userText = '';
    let userKey = '';
    // –ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã DOM
    const chat = document.getElementById('chat');
    const copyNotice = document.getElementById('copy-notice');
    // –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è localStorage
    let history = [];
    const savedHistory = localStorage.getItem('chatHistory');
    if (savedHistory) {
      history = JSON.parse(savedHistory);
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
      history.forEach(msg => {
        addMessage(msg.text, msg.type, false);
      });
    }
    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function addMessage(text, type = 'incoming', animate = true) {
      const msgElem = document.createElement('div');
      msgElem.className = 'message ' + (type === 'incoming' ? 'incoming' : 'outgoing');
      msgElem.textContent = text;
      if (animate) {
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
        msgElem.classList.add(type === 'incoming' ? 'fade-in-left' : 'fade-in-right');
        // –ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ —É–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å, —á—Ç–æ–±—ã –ø–æ–≤—Ç–æ—Ä–Ω–æ –Ω–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–µ
        msgElem.addEventListener('animationend', () => {
          msgElem.classList.remove(type === 'incoming' ? 'fade-in-left' : 'fade-in-right');
        });
      } else {
        msgElem.style.opacity = '1';
      }
      chat.appendChild(msgElem);
      chat.scrollTop = chat.scrollHeight;
      // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é –∏ –∑–∞–ø–∏—Å—å –≤ localStorage
      history.push({ text, type });
      localStorage.setItem('chatHistory', JSON.stringify(history));
    }
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ —à–∏—Ñ—Ä–æ–≤
    function showCipherOptions() {
      const ciphers = [
        { id: 'caesar', label: '–¶–µ–∑–∞—Ä—å' },
        { id: 'atbash', label: '–ê—Ç–±–∞—à' },
        { id: 'vigenere', label: '–í–∏–∂–µ–Ω–µ—Ä' },
        { id: 'base64', label: 'Base64' },
        { id: 'fernet', label: '–ü—Å–µ–≤–¥–æ-Fernet' }
      ];
      const optionsElem = document.createElement('div');
      ciphers.forEach(c => {
        const btn = document.createElement('button');
        btn.textContent = c.label;
        btn.className = 'button';
        btn.addEventListener('click', () => {
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —à–∏—Ñ—Ä
          optionsElem.remove(); // —É–±–∏—Ä–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞
          currentCipher = c.id;
          addMessage(c.label, 'outgoing'); // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∫–∞–∫ –∏—Å—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
          askForInput();
        });
        optionsElem.appendChild(btn);
      });
      chat.appendChild(optionsElem);
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π –º–µ–∂–¥—É –Ω–∏–º–∏
      const btns = optionsElem.querySelectorAll('.button');
      btns.forEach((b, index) => {
        setTimeout(() => b.classList.add('fade-in'), 50 * index);
      });
    }
    // –ó–∞–ø—Ä–æ—Å –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–ª—é—á–∞ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω) –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —à–∏—Ñ—Ä–∞
    function askForInput() {
      // –°–æ–æ–±—â–µ–Ω–∏–µ-–ø–æ–¥—Å–∫–∞–∑–∫–∞ –æ—Ç –±–æ—Ç–∞
      let promptText = '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è ';
      if (currentCipher === 'base64' || currentCipher === 'fernet') {
        promptText += '–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è/–¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è:';
      } else {
        promptText += '—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:';
      }
      addMessage(promptText, 'incoming');
      // –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä)
      const form = document.createElement('div');
      form.className = 'input-group';
      // –ú–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–µ –ø–æ–ª–µ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
      const textInput = document.createElement('textarea');
      textInput.placeholder = '–í–∞—à —Ç–µ–∫—Å—Ç';
      textInput.className = 'input-field';
      textInput.rows = 3;
      form.appendChild(textInput);
      let keyInput = null;
      // –ï—Å–ª–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —à–∏—Ñ—Ä–∞ –Ω—É–∂–µ–Ω –∫–ª—é—á
      if (currentCipher === 'caesar' || currentCipher === 'vigenere' || currentCipher === 'fernet') {
        keyInput = document.createElement('input');
        keyInput.placeholder = currentCipher === 'caesar' ? '–ö–ª—é—á (—á–∏—Å–ª–æ)' : '–ö–ª—é—á (—Ç–µ–∫—Å—Ç)';
        keyInput.className = 'input-field';
        keyInput.type = 'text';
        form.appendChild(keyInput);
        // –ö–Ω–æ–ø–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–ª—é—á–∞
        const genBtn = document.createElement('button');
        genBtn.textContent = 'üé≤';
        genBtn.className = 'button';
        genBtn.style.padding = '6px 8px';
        genBtn.title = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á';
        genBtn.addEventListener('click', () => {
          if (!keyInput) return;
          if (currentCipher === 'caesar') {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 32 –¥–ª—è —à–∏—Ñ—Ä–∞ –¶–µ–∑–∞—Ä—è
            keyInput.value = Math.floor(Math.random() * 32) + 1;
          } else if (currentCipher === 'vigenere') {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –±—É–∫–≤–µ–Ω–Ω—ã–π –∫–ª—é—á –¥–ª–∏–Ω–æ–π 5 (–ª–∞—Ç–∏–Ω–∏—Ü–∞)
            const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            let randKey = '';
            for (let i = 0; i < 5; i++) {
              randKey += alphabet.charAt(Math.floor(Math.random() * alphabet.length));
            }
            keyInput.value = randKey;
          } else if (currentCipher === 'fernet') {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 16 —Å–ª—É—á–∞–π–Ω—ã—Ö –±–∞–π—Ç–æ–≤ –∏ –∫–æ–¥–∏—Ä—É–µ–º –∏—Ö –≤ Base64 –∫–∞–∫ –∫–ª—é—á
            const bytes = new Uint8Array(16);
            window.crypto.getRandomValues(bytes);
            keyInput.value = btoa(String.fromCharCode(...bytes));
          }
        });
        form.appendChild(genBtn);
      }
      // –ö–Ω–æ–ø–∫–∏ "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å" –∏ "–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å"
      const encBtn = document.createElement('button');
      encBtn.textContent = '–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å';
      encBtn.className = 'button';
      const decBtn = document.createElement('button');
      decBtn.textContent = '–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å';
      decBtn.className = 'button';
      form.appendChild(encBtn);
      form.appendChild(decBtn);
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
      encBtn.addEventListener('click', () => {
        userText = textInput.value;
        userKey = keyInput ? keyInput.value : '';
        handleEncryption(true);
        form.remove();
      });
      decBtn.addEventListener('click', () => {
        userText = textInput.value;
        userKey = keyInput ? keyInput.value : '';
        handleEncryption(false);
        form.remove();
      });
      chat.appendChild(form);
      chat.scrollTop = chat.scrollHeight;
    }
    // –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    function handleEncryption(isEncrypt) {
      let result = '';
      const text = userText || '';
      const key = userKey || '';
      switch (currentCipher) {
        case 'caesar': {
          const shift = parseInt(key) || 0;
          result = caesarCipher(text, shift, isEncrypt);
          break;
        }
        case 'atbash': {
          result = atbashCipher(text);
          break;
        }
        case 'vigenere': {
          result = vigenereCipher(text, key, isEncrypt);
          break;
        }
        case 'base64': {
          if (isEncrypt) {
            // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Base64
            try {
              result = btoa(unescape(encodeURIComponent(text)));
            } catch (e) {
              result = '<–æ—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Base64>';
            }
          } else {
            try {
              result = decodeURIComponent(escape(atob(text)));
            } catch (e) {
              result = '<–æ—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Base64>';
            }
          }
          break;
        }
        case 'fernet': {
          // XOR + Base64
          try {
            if (isEncrypt) {
              const encrypted = xorEncrypt(text, key);
              result = btoa(encrypted);
            } else {
              const decoded = atob(text);
              result = xorEncrypt(decoded, key); // –ø–æ–≤—Ç–æ—Ä–Ω—ã–π XOR —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º
            }
          } catch (e) {
            result = '<–æ—à–∏–±–∫–∞ –≤ Fernet>';
          }
          break;
        }
      }
      // –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —á–∞—Ç
      addMessage(result, 'incoming');
      // –°–¥–µ–ª–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–ø–∏—Ä—É–µ–º—ã–º –ø—Ä–∏ –∫–ª–∏–∫–µ
      const messages = document.getElementsByClassName('message');
      const lastMessage = messages[messages.length - 1];
      lastMessage.style.cursor = 'pointer';
      lastMessage.addEventListener('click', () => copyToClipboard(result));
      // –ü–æ—Å–ª–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –≤—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π —à–∏—Ñ—Ä
      addMessage('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —à–∏—Ñ—Ä –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –¥—Ä—É–≥—É—é –æ–ø–µ—Ä–∞—Ü–∏—é:', 'incoming');
      showCipherOptions();
    }
    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:
    function caesarCipher(text, shift, encrypt = true) {
      const ruLower = '–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è';
      const ruUpper = '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø';
      const enLower = 'abcdefghijklmnopqrstuvwxyz';
      const enUpper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const nRu = ruLower.length;  // 33
      const nEn = enLower.length;  // 26
      shift = shift % nRu;
      if (!encrypt) {
        shift = -shift;
      }
      let result = '';
      for (let char of text) {
        if (ruLower.includes(char)) {
          let idx = ruLower.indexOf(char);
          idx = (idx + shift + nRu) % nRu;
          result += ruLower[idx];
        } else if (ruUpper.includes(char)) {
          let idx = ruUpper.indexOf(char);
          idx = (idx + shift + nRu) % nRu;
          result += ruUpper[idx];
        } else if (enLower.includes(char)) {
          let idx = enLower.indexOf(char);
          idx = (idx + shift + nEn) % nEn;
          result += enLower[idx];
        } else if (enUpper.includes(char)) {
          let idx = enUpper.indexOf(char);
          idx = (idx + shift + nEn) % nEn;
          result += enUpper[idx];
        } else {
          result += char;
        }
      }
      return result;
    }
    function atbashCipher(text) {
      const ruLower = '–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è';
      const ruUpper = '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø';
      const enLower = 'abcdefghijklmnopqrstuvwxyz';
      const enUpper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let result = '';
      for (let char of text) {
        if (ruLower.includes(char)) {
          let idx = ruLower.indexOf(char);
          result += ruLower[ruLower.length - 1 - idx];
        } else if (ruUpper.includes(char)) {
          let idx = ruUpper.indexOf(char);
          result += ruUpper[ruUpper.length - 1 - idx];
        } else if (enLower.includes(char)) {
          let idx = enLower.indexOf(char);
          result += enLower[enLower.length - 1 - idx];
        } else if (enUpper.includes(char)) {
          let idx = enUpper.indexOf(char);
          result += enUpper[enUpper.length - 1 - idx];
        } else {
          result += char;
        }
      }
      return result;
    }
    function vigenereCipher(text, key, encrypt = true) {
      const ruLower = '–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è';
      const ruUpper = '–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø';
      const enLower = 'abcdefghijklmnopqrstuvwxyz';
      const enUpper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let result = '';
      let keyIndex = 0;
      for (let char of text) {
        const kChar = key[keyIndex % key.length];
        if (!kChar) {
          // –ï—Å–ª–∏ –∫–ª—é—á –ø—É—Å—Ç–æ–π –∏–ª–∏ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
          result += char;
          continue;
        }
        if (ruLower.includes(char)) {
          const base = ruLower;
          const shift = ruLower.indexOf(kChar.toLowerCase());
          let idx = base.indexOf(char);
          idx = (idx + (encrypt ? shift : -shift) + base.length) % base.length;
          result += base[idx];
          keyIndex++;
        } else if (ruUpper.includes(char)) {
          const base = ruUpper;
          const shift = ruLower.indexOf(kChar.toLowerCase());
          let idx = base.indexOf(char);
          idx = (idx + (encrypt ? shift : -shift) + base.length) % base.length;
          result += base[idx];
          keyIndex++;
        } else if (enLower.includes(char)) {
          const base = enLower;
          const shift = enLower.indexOf(kChar.toLowerCase());
          let idx = base.indexOf(char);
          idx = (idx + (encrypt ? shift : -shift) + base.length) % base.length;
          result += base[idx];
          keyIndex++;
        } else if (enUpper.includes(char)) {
          const base = enUpper;
          const shift = enLower.indexOf(kChar.toLowerCase());
          let idx = base.indexOf(char);
          idx = (idx + (encrypt ? shift : -shift) + base.length) % base.length;
          result += base[idx];
          keyIndex++;
        } else {
          result += char;
        }
      }
      return result;
    }
    function xorEncrypt(text, key) {
      if (!key) return text;
      let result = '';
      // –ü—Ä–∏–º–µ–Ω—è–µ–º XOR –ø–æ—Å–∏–º–≤–æ–ª—å–Ω–æ, —Ü–∏–∫–ª–∏—á–Ω–æ –ø–æ –∫–ª—é—á—É
      for (let i = 0; i < text.length; i++) {
        const keyChar = key.charCodeAt(i % key.length);
        const textChar = text.charCodeAt(i);
        const xorChar = keyChar ^ textChar;
        result += String.fromCharCode(xorChar);
      }
      return result;
    }
    // –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showCopyNotice();
        });
      } else {
        // –§–æ–ª–ª–±—ç–∫ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
        const tempInput = document.createElement('textarea');
        tempInput.value = text;
        document.body.appendChild(tempInput);
        tempInput.select();
        try {
          document.execCommand('copy');
          showCopyNotice();
        } catch (err) {
          console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', err);
        }
        document.body.removeChild(tempInput);
      }
    }
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ" –Ω–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
    function showCopyNotice() {
      copyNotice.style.display = 'block';
      copyNotice.style.opacity = '1';
      setTimeout(() => {
        copyNotice.style.opacity = '0';
        setTimeout(() => {
          copyNotice.style.display = 'none';
        }, 300);
      }, 1000);
    }
    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –µ—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞, –≤—ã–≤–æ–¥–∏–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
    if (!savedHistory) {
      addMessage('–ü—Ä–∏–≤–µ—Ç! üîê –í—ã–±–µ—Ä–∏—Ç–µ —à–∏—Ñ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã:', 'incoming');
    }
    // –í—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä–∞ —à–∏—Ñ—Ä–∞ –≤ –Ω–∞—á–∞–ª–µ –∏–ª–∏ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    showCipherOptions();
  </script>
</body>
</html>
