<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #6c63ff;
            --accent-hover: #5a52d5;
            --success: #00ff88;
            --danger: #ff4757;
            --warning: #ffa502;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .header {
            background: linear-gradient(135deg, var(--accent) 0%, #9b59b6 100%);
            padding: 24px 16px;
            margin: 0 -16px 24px -16px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(108, 99, 255, 0.3);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .warning-banner {
            background: var(--warning);
            color: #000;
            padding: 12px 16px;
            margin: -8px -16px 20px -16px;
            text-align: center;
            font-weight: 600;
            font-size: 13px;
            border-radius: 0 0 12px 12px;
        }

        .tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 20px;
            overflow-x: auto;
            overflow-y: hidden;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            flex: 0 0 auto;
            min-width: 75px;
            padding: 10px 10px;
            background: var(--bg-card);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent);
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--accent);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-primary);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .btn {
            width: 100%;
            padding: 14px 24px;
            background: var(--accent);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(108, 99, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        .btn-success {
            background: var(--success);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.3);
        }

        .btn-warning {
            background: var(--warning);
            color: #000;
            box-shadow: 0 4px 12px rgba(255, 165, 2, 0.3);
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .method-card {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .method-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .method-card.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .method-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .method-name {
            font-size: 14px;
            font-weight: 600;
        }

        .result-box {
            background: var(--bg-secondary);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }

        .timer-display {
            background: var(--danger);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 18px;
            margin: 12px 0;
        }

        .key-item, .room-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .key-info, .room-info {
            flex: 1;
        }

        .key-name, .room-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .key-value, .room-key {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        .room-members {
            font-size: 12px;
            color: var(--success);
            margin-top: 4px;
        }

        .key-actions, .room-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-card);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        .qr-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin: 20px 0;
        }

        #qrcode {
            display: inline-block;
        }

        .file-upload-area {
            border: 2px dashed var(--accent);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 16px 0;
        }

        .file-upload-area:hover {
            background: var(--bg-secondary);
            border-color: var(--success);
        }

        .file-upload-area.dragover {
            background: var(--bg-secondary);
            border-color: var(--success);
        }

        .file-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .dev-notice {
            background: var(--warning);
            color: #000;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            font-weight: 600;
            text-align: center;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê CryptoApp</h1>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</p>
        </div>

        <div class="warning-banner">
            ‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('encrypt', event)">üîí –®–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            <button class="tab-btn" onclick="switchTab('keys', event)">üîë –ö–ª—é—á–∏</button>
            <button class="tab-btn" onclick="switchTab('files', event)">üìé –§–∞–π–ª—ã</button>
            <button class="tab-btn" onclick="switchTab('rooms', event)">üë• –ö–æ–º–Ω–∞—Ç—ã</button>
            <button class="tab-btn" onclick="switchTab('messages', event)">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</button>
            <button class="tab-btn" onclick="switchTab('tutorial', event)">üìö –°–ø—Ä–∞–≤–∫–∞</button>
        </div>

        <!-- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ -->
        <div id="encrypt-tab" class="tab-content active">
            <div class="card">
                <h3 class="card-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="method-grid">
                    <div class="method-card active" onclick="selectMethod('caesar', event)">
                        <div class="method-icon">1Ô∏è‚É£</div>
                        <div class="method-name">–¶–µ–∑–∞—Ä—å</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('atbash', event)">
                        <div class="method-icon">2Ô∏è‚É£</div>
                        <div class="method-name">–ê—Ç–±–∞—à</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('vigenere', event)">
                        <div class="method-icon">3Ô∏è‚É£</div>
                        <div class="method-name">–í–∏–∂–µ–Ω–µ—Ä</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('base64', event)">
                        <div class="method-icon">4Ô∏è‚É£</div>
                        <div class="method-name">Base64</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('fernet', event)">
                        <div class="method-icon">5Ô∏è‚É£</div>
                        <div class="method-name">Fernet</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="form-group" id="key-group">
                    <label class="form-label">üîë –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <input type="text" id="encrypt-key" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á...">
                </div>

                <div class="form-group">
                    <label class="form-label">üìù –í–∞—à —Ç–µ–∫—Å—Ç</label>
                    <textarea id="input-text" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">‚è±Ô∏è –¢–∞–π–º–µ—Ä —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è (—Å–µ–∫—É–Ω–¥—ã)</label>
                    <select class="form-select" id="timer-select">
                        <option value="0">–ë–µ–∑ —Ç–∞–π–º–µ—Ä–∞</option>
                        <option value="10">10 —Å–µ–∫—É–Ω–¥</option>
                        <option value="30">30 —Å–µ–∫—É–Ω–¥</option>
                        <option value="60">1 –º–∏–Ω—É—Ç–∞</option>
                        <option value="300">5 –º–∏–Ω—É—Ç</option>
                    </select>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="encryptText()">üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-danger" onclick="decryptText()">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div id="timer-container" style="display: none;">
                    <div class="timer-display" id="timer-display">üî•</div>
                </div>

                <div id="result-container" style="display: none;">
                    <div class="result-box" id="result-text"></div>
                    <button class="btn btn-secondary" onclick="copyResult()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –ö–ª—é—á–∏ -->
        <div id="keys-tab" class="tab-content">
            <div class="card">
                <h3 class="card-title">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π</h3>
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –∫–ª—é—á–∞</label>
                    <select class="form-select" id="key-type">
                        <option value="numeric">–ß–∏—Å–ª–æ–≤–æ–π (–¥–ª—è –¶–µ–∑–∞—Ä—è)</option>
                        <option value="word">–°–ª–æ–≤–µ—Å–Ω—ã–π (–¥–ª—è –í–∏–∂–µ–Ω–µ—Ä–∞)</option>
                        <option value="strong">–°–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å (–¥–ª—è Fernet)</option>
                    </select>
                </div>
                <button class="btn" onclick="generateKey()">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
                
                <div id="key-display" style="display: none;">
                    <div style="background: var(--bg-primary); border: 2px solid var(--success); border-radius: 12px; padding: 20px; text-align: center; margin: 20px 0;">
                        <div>–í–∞—à –Ω–æ–≤—ã–π –∫–ª—é—á:</div>
                        <div style="font-family: 'Courier New', monospace; font-size: 18px; font-weight: 700; color: var(--success); word-break: break-all; margin: 12px 0;" id="generated-key"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="saveKey()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-secondary" onclick="copyKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                    <button class="btn btn-warning" onclick="showQRCode()" style="margin-top: 12px;">üì± –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥</button>
                    
                    <div id="qr-container-wrapper" style="display: none;">
                        <div class="qr-container">
                            <div id="qrcode"></div>
                            <div style="margin-top: 12px; color: #000; font-weight: 600;">–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–ª—é—á–∞</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏</h3>
                <div id="saved-keys"></div>
            </div>
        </div>

        <!-- –§–∞–π–ª—ã -->
        <div id="files-tab" class="tab-content">
            <div class="card">
                <h3 class="card-title">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤</h3>
                
                <div class="file-upload-area" id="file-upload-area" onclick="document.getElementById('file-input').click()">
                    <div class="file-icon">üìÅ</div>
                    <div style="font-weight: 600; margin-bottom: 8px;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</div>
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">–ü–æ–¥–¥–µ—Ä–∂–∫–∞: TXT, PDF, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–¥–æ 5MB)</div>
                </div>
                
                <input type="file" id="file-input" style="display: none;" accept=".txt,.pdf,image/*">

                <div id="file-info" style="display: none; margin: 16px 0;">
                    <div style="background: var(--bg-secondary); padding: 12px; border-radius: 8px;">
                        <div style="font-weight: 600;" id="file-name"></div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;" id="file-size"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üîë –ü–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <input type="password" id="file-password" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–¥—ë–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å...">
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="encryptFile()">üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª</button>
                    <button class="btn btn-danger" onclick="decryptFile()">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª</button>
                </div>
            </div>
        </div>

        <!-- –ö–æ–º–Ω–∞—Ç—ã -->
        <div id="rooms-tab" class="tab-content">
            <div class="card">
                <h3 class="card-title">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</h3>
                <div class="form-group">
                    <label class="form-label">üë• –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã</label>
                    <input type="text" id="room-name" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞">
                </div>
                <div class="form-group">
                    <label class="form-label">üîë –û–±—â–∏–π –∫–ª—é—á</label>
                    <input type="text" id="room-key" class="form-input" placeholder="–ö–ª—é—á –¥–ª—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤">
                </div>
                <button class="btn btn-success" onclick="createRoom()">üöÄ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            </div>

            <div class="card">
                <h3 class="card-title">–ú–æ–∏ –∫–æ–º–Ω–∞—Ç—ã</h3>
                <div id="rooms-list"></div>
            </div>

            <div class="card">
                <h3 class="card-title">–í–æ–π—Ç–∏ –≤ –∫–æ–º–Ω–∞—Ç—É</h3>
                <div class="form-group">
                    <label class="form-label">üîë –ö–ª—é—á –∫–æ–º–Ω–∞—Ç—ã</label>
                    <input type="text" id="join-room-key" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –æ—Ç –¥—Ä—É–≥–∞">
                </div>
                <button class="btn" onclick="joinRoom()">üö™ –í–æ–π—Ç–∏</button>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div id="messages-tab" class="tab-content">
            <div class="dev-notice">
                ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ –ø–æ–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ
            </div>

            <div class="card">
                <h3 class="card-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
                
                <div class="form-group">
                    <label class="form-label">üîê –ú–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <select class="form-select" id="message-method" onchange="updateMessageKeyField()">
                        <option value="caesar">–®–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è</option>
                        <option value="atbash">–®–∏—Ñ—Ä –ê—Ç–±–∞—à</option>
                        <option value="vigenere">–®–∏—Ñ—Ä –í–∏–∂–µ–Ω–µ—Ä–∞</option>
                        <option value="base64" selected>Base64</option>
                        <option value="fernet">Fernet (AES)</option>
                    </select>
                </div>

                <div class="form-group" id="message-key-group" style="display: none;">
                    <label class="form-label">üîë –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <input type="text" id="message-key" class="form-input" placeholder="–ö–ª—é—á –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è">
                </div>
                
                <div class="form-group">
                    <label class="form-label">üÜî ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                    <input type="text" id="recipient-id" class="form-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 123456789">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
                        üí° –ü–æ–ª—É—á–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —É–∑–Ω–∞—Ç—å —Å–≤–æ–π ID —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É /start –≤ –±–æ—Ç–µ
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ</label>
                    <textarea id="message-text" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
                </div>
                
                <button class="btn btn-warning" onclick="sendMessage()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)</button>
            </div>

            <div class="card">
                <h3 class="card-title">–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                <div id="messages-list"></div>
            </div>
        </div>

        <!-- –°–ø—Ä–∞–≤–∫–∞ -->
        <div id="tutorial-tab" class="tab-content">
            <div class="card">
                <h3 class="card-title">üÜï –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</h3>
                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">üì± QR-–∫–æ–¥—ã –¥–ª—è –∫–ª—é—á–µ–π</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ —Å –∫–ª—é—á–æ–º –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –µ–≥–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ, –ø—Ä–æ—Å—Ç–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–≤ –∫–∞–º–µ—Ä–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω–∞.
                    </div>
                </div>

                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">üìé –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Ñ–∞–π–ª—ã –¥–æ 5MB –∏ —à–∏—Ñ—Ä—É–π—Ç–µ –∏—Ö –Ω–∞–¥—ë–∂–Ω—ã–º –ø–∞—Ä–æ–ª–µ–º. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ TXT, PDF –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
                    </div>
                </div>

                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">‚è±Ô∏è –¢–∞–π–º–µ—Ä —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–∞–π–º–µ—Ä, –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å—á–µ–∑–Ω–µ—Ç —á–µ—Ä–µ–∑ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è. –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ—Å–æ–±–æ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π!
                    </div>
                </div>

                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">üë• –ì—Ä—É–ø–ø–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–º–Ω–∞—Ç—ã —Å –æ–±—â–∏–º –∫–ª—é—á–æ–º –¥–ª—è –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ –æ–±—â–µ–Ω–∏—è. –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∫–ª—é—á –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π.
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; color: var(--text-primary); border-collapse: collapse;">
                        <tr style="border-bottom: 2px solid var(--accent);">
                            <th style="padding: 12px; text-align: left;">–ú–µ—Ç–æ–¥</th>
                            <th style="padding: 12px; text-align: left;">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</th>
                            <th style="padding: 12px; text-align: left;">–°–∫–æ—Ä–æ—Å—Ç—å</th>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–¶–µ–∑–∞—Ä—å</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–ê—Ç–±–∞—à</td>
                            <td style="padding: 12px;">‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–í–∏–∂–µ–Ω–µ—Ä</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">Base64</td>
                            <td style="padding: 12px;">‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">Fernet</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–ê—Ç–±–∞—à</td>
                            <td style="padding: 12px;">‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–í–∏–∂–µ–Ω–µ—Ä</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">Base64</td>
                            <td style="padding: 12px;">‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">Fernet</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">1. –í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π - –¶–µ–∑–∞—Ä—å –∏–ª–∏ –í–∏–∂–µ–Ω–µ—Ä. –î–ª—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ - —Ç–æ–ª—å–∫–æ Fernet!
                    </div>
                </div>

                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">2. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π –∏–ª–∏ –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–≤–æ–π. –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ–ª—É—á–∞—Ç–µ–ª—å.
                    </div>
                </div>

                <div style="background: var(--bg-secondary); padding: 16px; border-radius: 8px;">
                    <div style="font-weight: 600; margin-bottom: 8px;">3. –ü–µ—Ä–µ–¥–∞–π—Ç–µ –∫–ª—é—á –±–µ–∑–æ–ø–∞—Å–Ω–æ</div>
                    <div style="font-size: 13px; color: var(--text-secondary);">
                        –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–ª—é—á –≤–º–µ—Å—Ç–µ —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ QR-–∫–æ–¥, –≥–æ–ª–æ—Å–æ–≤—É—é —Å–≤—è–∑—å –∏–ª–∏ –¥—Ä—É–≥–æ–π –∫–∞–Ω–∞–ª.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.text = "–ó–∞–∫—Ä—ã—Ç—å";
        tg.MainButton.show();
        tg.MainButton.onClick(() => tg.close());

        let currentMethod = 'caesar';
        let savedKeys = JSON.parse(localStorage.getItem('cryptoKeys') || '[]');
        let messages = JSON.parse(localStorage.getItem('cryptoMessages') || '[]');
        let rooms = JSON.parse(localStorage.getItem('cryptoRooms') || '[]');
        let currentFile = null;
        let destructTimer = null;

        function switchTab(tab, evt) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if (evt && evt.target) {
                evt.target.classList.add('active');
            }
            document.getElementById(tab + '-tab').classList.add('active');
            
            if (tab === 'keys') loadSavedKeys();
            if (tab === 'messages') loadMessages();
            if (tab === 'rooms') loadRooms();
        }

        function selectMethod(method, evt) {
            currentMethod = method;
            document.querySelectorAll('.method-card').forEach(card => card.classList.remove('active'));
            
            if (evt && evt.target) {
                evt.target.closest('.method-card').classList.add('active');
            }
            
            const keyGroup = document.getElementById('key-group');
            if (method === 'atbash' || method === 'base64') {
                keyGroup.style.display = 'none';
            } else {
                keyGroup.style.display = 'block';
                const placeholder = method === 'caesar' ? '–ß–∏—Å–ª–æ –æ—Ç 1 –¥–æ 25' : 
                                  method === 'vigenere' ? '–°–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞' : 
                                  '–ü–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è';
                document.getElementById('encrypt-key').placeholder = placeholder;
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        function caesarCipher(text, shift, decrypt = false) {
            if (decrypt) shift = -shift;
            let result = '';
            for (let char of text) {
                if (char >= '–ê' && char <= '–Ø') {
                    result += String.fromCharCode((char.charCodeAt(0) - '–ê'.charCodeAt(0) + shift + 32) % 32 + '–ê'.charCodeAt(0));
                } else if (char >= '–∞' && char <= '—è') {
                    result += String.fromCharCode((char.charCodeAt(0) - '–∞'.charCodeAt(0) + shift + 32) % 32 + '–∞'.charCodeAt(0));
                } else if (char >= 'A' && char <= 'Z') {
                    result += String.fromCharCode((char.charCodeAt(0) - 'A'.charCodeAt(0) + shift + 26) % 26 + 'A'.charCodeAt(0));
                } else if (char >= 'a' && char <= 'z') {
                    result += String.fromCharCode((char.charCodeAt(0) - 'a'.charCodeAt(0) + shift + 26) % 26 + 'a'.charCodeAt(0));
                } else if (char >= '0' && char <= '9') {
                    result += String.fromCharCode((char.charCodeAt(0) - '0'.charCodeAt(0) + shift + 10) % 10 + '0'.charCodeAt(0));
                } else {
                    result += char;
                }
            }
            return result;
        }

        function atbashCipher(text) {
            let result = '';
            for (let char of text) {
                if (char >= '–ê' && char <= '–Ø') {
                    result += String.fromCharCode('–Ø'.charCodeAt(0) - (char.charCodeAt(0) - '–ê'.charCodeAt(0)));
                } else if (char >= '–∞' && char <= '—è') {
                    result += String.fromCharCode('—è'.charCodeAt(0) - (char.charCodeAt(0) - '–∞'.charCodeAt(0)));
                } else if (char >= 'A' && char <= 'Z') {
                    result += String.fromCharCode('Z'.charCodeAt(0) - (char.charCodeAt(0) - 'A'.charCodeAt(0)));
                } else if (char >= 'a' && char <= 'z') {
                    result += String.fromCharCode('z'.charCodeAt(0) - (char.charCodeAt(0) - 'a'.charCodeAt(0)));
                } else if (char >= '0' && char <= '9') {
                    result += String.fromCharCode('9'.charCodeAt(0) - (char.charCodeAt(0) - '0'.charCodeAt(0)));
                } else {
                    result += char;
                }
            }
            return result;
        }

        function vigenereCipher(text, key, decrypt = false) {
            let result = '';
            key = key.toUpperCase();
            let keyIndex = 0;
            
            for (let char of text) {
                if (/[–∞-—è–ê-–Øa-zA-Z0-9]/.test(char)) {
                    let keyChar = key[keyIndex % key.length];
                    let shift = keyChar >= '–ê' && keyChar <= '–Ø' ? 
                              keyChar.charCodeAt(0) - '–ê'.charCodeAt(0) : 
                              keyChar.charCodeAt(0) - 'A'.charCodeAt(0);
                    
                    if (decrypt) shift = -shift;
                    
                    if (char >= '–ê' && char <= '–Ø') {
                        result += String.fromCharCode((char.charCodeAt(0) - '–ê'.charCodeAt(0) + shift + 32) % 32 + '–ê'.charCodeAt(0));
                    } else if (char >= '–∞' && char <= '—è') {
                        result += String.fromCharCode((char.charCodeAt(0) - '–∞'.charCodeAt(0) + shift + 32) % 32 + '–∞'.charCodeAt(0));
                    } else if (char >= 'A' && char <= 'Z') {
                        result += String.fromCharCode((char.charCodeAt(0) - 'A'.charCodeAt(0) + shift + 26) % 26 + 'A'.charCodeAt(0));
                    } else if (char >= 'a' && char <= 'z') {
                        result += String.fromCharCode((char.charCodeAt(0) - 'a'.charCodeAt(0) + shift + 26) % 26 + 'a'.charCodeAt(0));
                    } else if (char >= '0' && char <= '9') {
                        result += String.fromCharCode((char.charCodeAt(0) - '0'.charCodeAt(0) + shift + 10) % 10 + '0'.charCodeAt(0));
                    }
                    keyIndex++;
                } else {
                    result += char;
                }
            }
            return result;
        }

        function base64Encode(text) {
            return btoa(unescape(encodeURIComponent(text)));
        }

        function base64Decode(text) {
            try {
                return decodeURIComponent(escape(atob(text)));
            } catch {
                return '‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è';
            }
        }

        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç–∞–π–º–µ—Ä–æ–º
        function encryptText() {
            const text = document.getElementById('input-text').value;
            if (!text) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!');
                return;
            }

            const key = document.getElementById('encrypt-key').value;
            const timerSeconds = parseInt(document.getElementById('timer-select').value);
            let result = '';

            try {
                switch(currentMethod) {
                    case 'caesar':
                        const shift = parseInt(key);
                        if (!shift || shift < 1 || shift > 25) {
                            showToast('‚ùå –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 25');
                            return;
                        }
                        result = caesarCipher(text, shift);
                        break;
                    case 'atbash':
                        result = atbashCipher(text);
                        break;
                    case 'vigenere':
                        if (!key) {
                            showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                            return;
                        }
                        result = vigenereCipher(text, key);
                        break;
                    case 'base64':
                        result = base64Encode(text);
                        break;
                    case 'fernet':
                        if (!key) {
                            showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                            return;
                        }
                        result = `FERNET:${key}:${base64Encode(text)}`;
                        break;
                }

                document.getElementById('result-text').textContent = result;
                document.getElementById('result-container').style.display = 'block';
                showToast('‚úÖ –¢–µ–∫—Å—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω!');

                // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ —Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏—è
                if (timerSeconds > 0) {
                    startDestructTimer(timerSeconds);
                }
            } catch (error) {
                showToast('‚ùå –û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
            }
        }

        function startDestructTimer(seconds) {
            if (destructTimer) clearInterval(destructTimer);
            
            document.getElementById('timer-container').style.display = 'block';
            let remaining = seconds;
            
            const updateDisplay = () => {
                document.getElementById('timer-display').textContent = `üî• –°–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${remaining} —Å–µ–∫`;
            };
            
            updateDisplay();
            
            destructTimer = setInterval(() => {
                remaining--;
                if (remaining <= 0) {
                    clearInterval(destructTimer);
                    document.getElementById('result-text').textContent = 'üî• –°–û–û–ë–©–ï–ù–ò–ï –£–ù–ò–ß–¢–û–ñ–ï–ù–û';
                    document.getElementById('timer-display').textContent = 'üí• –£–ù–ò–ß–¢–û–ñ–ï–ù–û';
                    setTimeout(() => {
                        document.getElementById('result-container').style.display = 'none';
                        document.getElementById('timer-container').style.display = 'none';
                    }, 2000);
                } else {
                    updateDisplay();
                }
            }, 1000);
        }

        function decryptText() {
            const text = document.getElementById('input-text').value;
            if (!text) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!');
                return;
            }

            const key = document.getElementById('encrypt-key').value;
            let result = '';

            try {
                switch(currentMethod) {
                    case 'caesar':
                        const shift = parseInt(key);
                        if (!shift || shift < 1 || shift > 25) {
                            showToast('‚ùå –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 25');
                            return;
                        }
                        result = caesarCipher(text, shift, true);
                        break;
                    case 'atbash':
                        result = atbashCipher(text);
                        break;
                    case 'vigenere':
                        if (!key) {
                            showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                            return;
                        }
                        result = vigenereCipher(text, key, true);
                        break;
                    case 'base64':
                        result = base64Decode(text);
                        break;
                    case 'fernet':
                        if (!key) {
                            showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                            return;
                        }
                        if (text.startsWith('FERNET:')) {
                            const parts = text.split(':');
                            if (parts[1] === key) {
                                result = base64Decode(parts[2]);
                            } else {
                                showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á!');
                                return;
                            }
                        } else {
                            showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
                            return;
                        }
                        break;
                }

                document.getElementById('result-text').textContent = result;
                document.getElementById('result-container').style.display = 'block';
                document.getElementById('timer-container').style.display = 'none';
                showToast('‚úÖ –¢–µ–∫—Å—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω!');
            } catch (error) {
                showToast('‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
            }
        }

        function copyResult() {
            const result = document.getElementById('result-text').textContent;
            navigator.clipboard.writeText(result);
            showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
        }

        // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π —Å QR
        function generateKey() {
            const type = document.getElementById('key-type').value;
            let key = '';

            switch(type) {
                case 'numeric':
                    key = Math.floor(Math.random() * 25) + 1;
                    break;
                case 'word':
                    const words = ['–°–ï–ö–†–ï–¢', '–ü–ê–†–û–õ–¨', '–ö–õ–Æ–ß', '–ó–ê–©–ò–¢–ê', 'CRYPTO', 'SECRET', 'GUARDIAN', 'PHOENIX', 'DRAGON', 'KNIGHT'];
                    key = words[Math.floor(Math.random() * words.length)];
                    break;
                case 'strong':
                    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                    for (let i = 0; i < 16; i++) {
                        key += chars.charAt(Math.floor(Math.random() * chars.length));
                    }
                    break;
            }

            document.getElementById('generated-key').textContent = key;
            document.getElementById('key-display').style.display = 'block';
            document.getElementById('qr-container-wrapper').style.display = 'none';
            showToast('üé≤ –ö–ª—é—á —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
        }

        function showQRCode() {
            const key = document.getElementById('generated-key').textContent;
            const qrContainer = document.getElementById('qr-container-wrapper');
            const qrDiv = document.getElementById('qrcode');
            
            qrDiv.innerHTML = '';
            qrContainer.style.display = 'block';
            
            new QRCode(qrDiv, {
                text: key,
                width: 200,
                height: 200,
                colorDark: "#6c63ff",
                colorLight: "#ffffff"
            });
            
            showToast('üì± QR-–∫–æ–¥ —Å–æ–∑–¥–∞–Ω!');
        }

        function saveKey() {
            const key = document.getElementById('generated-key').textContent;
            const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—é—á–∞:', '–ö–ª—é—á ' + (savedKeys.length + 1));
            
            if (name) {
                savedKeys.push({
                    id: Date.now(),
                    name: name,
                    value: key,
                    date: new Date().toLocaleDateString()
                });
                localStorage.setItem('cryptoKeys', JSON.stringify(savedKeys));
                showToast('üíæ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
                loadSavedKeys();
            }
        }

        function copyKey() {
            const key = document.getElementById('generated-key').textContent;
            navigator.clipboard.writeText(key);
            showToast('üìã –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
        }

        function loadSavedKeys() {
            const container = document.getElementById('saved-keys');
            
            if (savedKeys.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üîë</div><div>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π</div></div>';
                return;
            }

            container.innerHTML = savedKeys.map(key => `
                <div class="key-item">
                    <div class="key-info">
                        <div class="key-name">${key.name}</div>
                        <div class="key-value">${key.value}</div>
                    </div>
                    <div class="key-actions">
                        <button class="icon-btn" onclick="copyStoredKey('${key.value}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                        <button class="icon-btn" onclick="deleteKey(${key.id})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function copyStoredKey(value) {
            navigator.clipboard.writeText(value);
            showToast('üìã –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
        }

        function deleteKey(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–ª—é—á?')) {
                savedKeys = savedKeys.filter(k => k.id !== id);
                localStorage.setItem('cryptoKeys', JSON.stringify(savedKeys));
                loadSavedKeys();
                showToast('üóëÔ∏è –ö–ª—é—á —É–¥–∞–ª–µ–Ω');
            }
        }

        // –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
        document.getElementById('file-input').addEventListener('change', handleFileSelect);
        
        const uploadArea = document.getElementById('file-upload-area');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                document.getElementById('file-input').files = e.dataTransfer.files;
                handleFileSelect({target: {files: [file]}});
            }
        });

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 5MB)');
                return;
            }
            
            currentFile = file;
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = (file.size / 1024).toFixed(2) + ' KB';
            document.getElementById('file-info').style.display = 'block';
        }

        function encryptFile() {
            if (!currentFile) {
                showToast('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!');
                return;
            }
            
            const password = document.getElementById('file-password').value;
            if (!password) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                const encrypted = base64Encode(content);
                const finalEncrypted = `ENCRYPTED:${password}:${encrypted}`;
                
                const blob = new Blob([finalEncrypted], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = currentFile.name + '.encrypted';
                a.click();
                
                showToast('‚úÖ –§–∞–π–ª –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω!');
            };
            reader.readAsText(currentFile);
        }

        function decryptFile() {
            if (!currentFile) {
                showToast('‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª!');
                return;
            }
            
            const password = document.getElementById('file-password').value;
            if (!password) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                
                if (!content.startsWith('ENCRYPTED:')) {
                    showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                    return;
                }
                
                const parts = content.split(':');
                if (parts[1] !== password) {
                    showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
                    return;
                }
                
                try {
                    const decrypted = base64Decode(parts[2]);
                    const blob = new Blob([decrypted], {type: 'text/plain'});
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = currentFile.name.replace('.encrypted', '');
                    a.click();
                    
                    showToast('‚úÖ –§–∞–π–ª —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω!');
                } catch {
                    showToast('‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
                }
            };
            reader.readAsText(currentFile);
        }

        // –ì—Ä—É–ø–ø–æ–≤—ã–µ –∫–æ–º–Ω–∞—Ç—ã
        function createRoom() {
            const name = document.getElementById('room-name').value;
            const key = document.getElementById('room-key').value;
            
            if (!name || !key) {
                showToast('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }
            
            rooms.push({
                id: Date.now(),
                name: name,
                key: key,
                members: 1,
                created: new Date().toLocaleString()
            });
            
            localStorage.setItem('cryptoRooms', JSON.stringify(rooms));
            document.getElementById('room-name').value = '';
            document.getElementById('room-key').value = '';
            loadRooms();
            showToast('üöÄ –ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!');
        }

        function joinRoom() {
            const key = document.getElementById('join-room-key').value;
            if (!key) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –∫–æ–º–Ω–∞—Ç—ã!');
                return;
            }
            
            const room = rooms.find(r => r.key === key);
            if (room) {
                room.members++;
                localStorage.setItem('cryptoRooms', JSON.stringify(rooms));
                loadRooms();
                showToast(`‚úÖ –í—ã –≤–æ—à–ª–∏ –≤ –∫–æ–º–Ω–∞—Ç—É "${room.name}"!`);
                document.getElementById('join-room-key').value = '';
            } else {
                showToast('‚ùå –ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
        }

        function loadRooms() {
            const container = document.getElementById('rooms-list');
            
            if (rooms.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-icon">üë•</div><div>–ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç</div></div>';
                return;
            }

            container.innerHTML = rooms.map(room => `
                <div class="room-item">
                    <div class="room-info">
                        <div class="room-name">üë• ${room.name}</div>
                        <div class="room-key">üîë –ö–ª—é—á: ${room.key}</div>
                        <div class="room-members">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${room.members}</div>
                    </div>
                    <div class="room-actions">
                        <button class="icon-btn" onclick="copyRoomKey('${room.key}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á">üìã</button>
                        <button class="icon-btn" onclick="deleteRoom(${room.id})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }

        function copyRoomKey(key) {
            navigator.clipboard.writeText(key);
            showToast('üìã –ö–ª—é—á –∫–æ–º–Ω–∞—Ç—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
        }

        function deleteRoom(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–º–Ω–∞—Ç—É?')) {
                rooms = rooms.filter(r => r.id !== id);
                localStorage.setItem('cryptoRooms', JSON.stringify(rooms));
                loadRooms();
                showToast('üóëÔ∏è –ö–æ–º–Ω–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∞');
            }
        }

        // –°–æ–æ–±—â–µ–Ω–∏—è (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
        function updateMessageKeyField() {
            const method = document.getElementById('message-method').value;
            currentMethod = method;
            const keyGroup = document.getElementById('message-key-group');
            const keyInput = document.getElementById('message-key');
            
            if (method === 'atbash' || method === 'base64') {
                keyGroup.style.display = 'none';
            } else {
                keyGroup.style.display = 'block';
                const placeholders = {
                    'caesar': '–ß–∏—Å–ª–æ –æ—Ç 1 –¥–æ 25',
                    'vigenere': '–°–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: SECRET)',
                    'fernet': '–ü–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è'
                };
                keyInput.placeholder = placeholders[method];
            }
        }

        function sendMessage() {
            showToast('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!');
            // –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ
        }

        function loadMessages() {
            const container = document.getElementById('messages-list');
            container.innerHTML = '<div class="empty-state"><div class="empty-icon">üí¨</div><div>–§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</div></div>';
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadSavedKeys();
        loadMessages();
        loadRooms();
        updateMessageKeyField();
    </script>
</body>
</html>
