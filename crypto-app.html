<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #6c63ff;
            --accent-hover: #5a52d5;
            --success: #00ff88;
            --danger: #ff4757;
            --warning: #ffa502;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .header {
            background: linear-gradient(135deg, var(--accent) 0%, #9b59b6 100%);
            padding: 24px 16px;
            margin: 0 -16px 24px -16px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(108, 99, 255, 0.3);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

    .tabs {
    display: flex;
    gap: 6px;
    margin-bottom: 20px;
    overflow-x: auto;
    overflow-y: hidden;
    padding-bottom: 8px;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
}

.tabs::-webkit-scrollbar {
    display: none;
}
        .tab-btn {
            flex: 0 0 auto;
            min-width: 85px;
            padding: 10px 12px;
            font-size: 13px;
            background: var(--bg-card);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            background: var(--bg-secondary);
            border-color: var(--accent);
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--accent);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-primary);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .btn {
            width: 100%;
            padding: 14px 24px;
            background: var(--accent);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
        }

        .btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(108, 99, 255, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            box-shadow: none;
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        .btn-success {
            background: var(--success);
            box-shadow: 0 4px 12px rgba(0, 255, 136, 0.3);
        }

        .btn-danger {
            background: var(--danger);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.3);
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .method-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .method-card {
            background: var(--bg-secondary);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .method-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .method-card.active {
            background: var(--accent);
            border-color: var(--accent);
        }

        .method-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .method-name {
            font-size: 14px;
            font-weight: 600;
        }

        .result-box {
            background: var(--bg-secondary);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            margin: 16px 0;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }

        .key-item {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .key-info {
            flex: 1;
        }

        .key-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .key-value {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: 'Courier New', monospace;
        }

        .key-actions {
            display: flex;
            gap: 8px;
        }

        .icon-btn {
            background: var(--bg-card);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: var(--accent);
            transform: scale(1.1);
        }

        .message-item {
            background: var(--bg-secondary);
            border-left: 4px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .message-time {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .message-text {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            word-break: break-all;
            background: var(--bg-primary);
            padding: 12px;
            border-radius: 8px;
            margin-top: 8px;
        }

        .tutorial-step {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .tutorial-number {
            background: var(--accent);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .tutorial-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .tutorial-desc {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .key-display {
            background: var(--bg-primary);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
        }

        .generated-key {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: 700;
            color: var(--success);
            word-break: break-all;
            margin: 12px 0;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 4px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê CryptoApp</h1>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('encrypt')">üîí –®–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
            <button class="tab-btn" onclick="switchTab('keys')">üîë –ö–ª—é—á–∏</button>
            <button class="tab-btn" onclick="switchTab('messages')">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</button>
            <button class="tab-btn" onclick="switchTab('tutorial')">üìö –û–±—É—á–µ–Ω–∏–µ</button>
        </div>

        <div id="encrypt-tab" class="tab-content active">
            <div class="card">
                <h3 class="card-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="method-grid">
                    <div class="method-card active" onclick="selectMethod('caesar')">
                        <div class="method-icon">1Ô∏è‚É£</div>
                        <div class="method-name">–¶–µ–∑–∞—Ä—å</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('atbash')">
                        <div class="method-icon">2Ô∏è‚É£</div>
                        <div class="method-name">–ê—Ç–±–∞—à</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('vigenere')">
                        <div class="method-icon">3Ô∏è‚É£</div>
                        <div class="method-name">–í–∏–∂–µ–Ω–µ—Ä</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('base64')">
                        <div class="method-icon">4Ô∏è‚É£</div>
                        <div class="method-name">Base64</div>
                    </div>
                    <div class="method-card" onclick="selectMethod('fernet')">
                        <div class="method-icon">5Ô∏è‚É£</div>
                        <div class="method-name">Fernet</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="form-group" id="key-group">
                    <label class="form-label">üîë –ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</label>
                    <input type="text" id="encrypt-key" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á...">
                </div>

                <div class="form-group">
                    <label class="form-label">üìù –í–∞—à —Ç–µ–∫—Å—Ç</label>
                    <textarea id="input-text" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è..."></textarea>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="encryptText()">üîí –ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-danger" onclick="decryptText()">üîì –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <div id="result-container" style="display: none;">
                    <div class="result-box" id="result-text"></div>
                    <button class="btn btn-secondary" onclick="copyResult()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
            </div>
        </div>

        <div id="keys-tab" class="tab-content">
            <div class="card">
                <h3 class="card-title">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–ª—é—á–µ–π</h3>
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –∫–ª—é—á–∞</label>
                    <select class="form-select" id="key-type">
                        <option value="numeric">–ß–∏—Å–ª–æ–≤–æ–π (–¥–ª—è –¶–µ–∑–∞—Ä—è)</option>
                        <option value="word">–°–ª–æ–≤–µ—Å–Ω—ã–π (–¥–ª—è –í–∏–∂–µ–Ω–µ—Ä–∞)</option>
                        <option value="strong">–°–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å (–¥–ª—è Fernet)</option>
                    </select>
                </div>
                <button class="btn" onclick="generateKey()">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á</button>
                
                <div id="key-display" style="display: none;">
                    <div class="key-display">
                        <div>–í–∞—à –Ω–æ–≤—ã–π –∫–ª—é—á:</div>
                        <div class="generated-key" id="generated-key"></div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="saveKey()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-secondary" onclick="copyKey()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏</h3>
                <div id="saved-keys"></div>
            </div>
        </div>

        <div id="messages-tab" class="tab-content">
            <div class="card">
                <h3 class="card-title">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h3>
                <div class="form-group">
                    <label class="form-label">ID –ø–æ–ª—É—á–∞—Ç–µ–ª—è</label>
                    <input type="text" id="recipient-id" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ Telegram ID...">
                </div>
                <div class="form-group">
                    <label class="form-label">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
                    <textarea id="message-text" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."></textarea>
                </div>
                <button class="btn" onclick="sendMessage()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>

            <div class="card">
                <h3 class="card-title">–ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                <div id="messages-list"></div>
            </div>
        </div>

        <div id="tutorial-tab" class="tab-content">
            <div class="tutorial-step">
                <div class="tutorial-number">1</div>
                <div class="tutorial-title">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Ç–æ–¥ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</div>
                <div class="tutorial-desc">
                    –ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –∏–º–µ–µ—Ç —Å–≤–æ—é —Å—Ç–µ–ø–µ–Ω—å –∑–∞—â–∏—Ç—ã. –î–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–¥–æ–π–¥–µ—Ç –¶–µ–∑–∞—Ä—å –∏–ª–∏ –í–∏–∂–µ–Ω–µ—Ä, –¥–ª—è –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Fernet.
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-number">2</div>
                <div class="tutorial-title">–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á</div>
                <div class="tutorial-desc">
                    –ö–ª—é—á - —ç—Ç–æ —Å–µ–∫—Ä–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤—ã –∏ –ø–æ–ª—É—á–∞—Ç–µ–ª—å. –ë–µ–∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-number">3</div>
                <div class="tutorial-title">–ó–∞—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</div>
                <div class="tutorial-desc">
                    –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å". –ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º—É —É–≥–æ–¥–Ω–æ.
                </div>
            </div>

            <div class="tutorial-step">
                <div class="tutorial-number">4</div>
                <div class="tutorial-title">–ü–µ—Ä–µ–¥–∞–π—Ç–µ –∫–ª—é—á –±–µ–∑–æ–ø–∞—Å–Ω–æ</div>
                <div class="tutorial-desc">
                    –ö–ª—é—á –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–æ–ª—É—á–∞—Ç–µ–ª—é –æ—Ç–¥–µ–ª—å–Ω–æ (–≥–æ–ª–æ—Å–æ–º, –¥—Ä—É–≥–∏–º –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–æ–º). –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∫–ª—é—á –≤–º–µ—Å—Ç–µ —Å –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º!
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; color: var(--text-primary); border-collapse: collapse;">
                        <tr style="border-bottom: 2px solid var(--accent);">
                            <th style="padding: 12px; text-align: left;">–ú–µ—Ç–æ–¥</th>
                            <th style="padding: 12px; text-align: left;">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</th>
                            <th style="padding: 12px; text-align: left;">–°–∫–æ—Ä–æ—Å—Ç—å</th>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–¶–µ–∑–∞—Ä—å</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–ê—Ç–±–∞—à</td>
                            <td style="padding: 12px;">‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">–í–∏–∂–µ–Ω–µ—Ä</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">Base64</td>
                            <td style="padding: 12px;">‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°‚ö°</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px;">Fernet</td>
                            <td style="padding: 12px;">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
                            <td style="padding: 12px;">‚ö°‚ö°</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.text = "–ó–∞–∫—Ä—ã—Ç—å";
        tg.MainButton.show();
        tg.MainButton.onClick(() => tg.close());

        let currentMethod = 'caesar';
        let savedKeys = JSON.parse(localStorage.getItem('cryptoKeys') || '[]');
        let messages = JSON.parse(localStorage.getItem('cryptoMessages') || '[]');

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
            
            if (tab === 'keys') loadSavedKeys();
            if (tab === 'messages') loadMessages();
        }

        function selectMethod(method) {
            currentMethod = method;
            document.querySelectorAll('.method-card').forEach(card => card.classList.remove('active'));
            event.target.closest('.method-card').classList.add('active');
            
            const keyGroup = document.getElementById('key-group');
            if (method === 'atbash' || method === 'base64') {
                keyGroup.style.display = 'none';
            } else {
                keyGroup.style.display = 'block';
                const placeholder = method === 'caesar' ? '–ß–∏—Å–ª–æ –æ—Ç 1 –¥–æ 25' : 
                                  method === 'vigenere' ? '–°–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞' : 
                                  '–ü–∞—Ä–æ–ª—å –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è';
                document.getElementById('encrypt-key').placeholder = placeholder;
            }
        }

        function caesarCipher(text, shift, decrypt = false) {
            if (decrypt) shift = -shift;
            let result = '';
            for (let char of text) {
                if (char >= '–ê' && char <= '–Ø') {
                    result += String.fromCharCode((char.charCodeAt(0) - '–ê'.charCodeAt(0) + shift + 32) % 32 + '–ê'.charCodeAt(0));
                } else if (char >= '–∞' && char <= '—è') {
                    result += String.fromCharCode((char.charCodeAt(0) - '–∞'.charCodeAt(0) + shift + 32) % 32 + '–∞'.charCodeAt(0));
                } else if (char >= 'A' && char <= 'Z') {
                    result += String.fromCharCode((char.charCodeAt(0) - 'A'.charCodeAt(0) + shift + 26) % 26 + 'A'.charCodeAt(0));
                } else if (char >= 'a' && char <= 'z') {
                    result += String.fromCharCode((char.charCodeAt(0) - 'a'.charCodeAt(0) + shift + 26) % 26 + 'a'.charCodeAt(0));
                } else if (char >= '0' && char <= '9') {
                    result += String.fromCharCode((char.charCodeAt(0) - '0'.charCodeAt(0) + shift + 10) % 10 + '0'.charCodeAt(0));
                } else {
                    result += char;
                }
            }
            return result;
        }

        function atbashCipher(text) {
            let result = '';
            for (let char of text) {
                if (char >= '–ê' && char <= '–Ø') {
                    result += String.fromCharCode('–Ø'.charCodeAt(0) - (char.charCodeAt(0) - '–ê'.charCodeAt(0)));
                } else if (char >= '–∞' && char <= '—è') {
                    result += String.fromCharCode('—è'.charCodeAt(0) - (char.charCodeAt(0) - '–∞'.charCodeAt(0)));
                } else if (char >= 'A' && char <= 'Z') {
                    result += String.fromCharCode('Z'.charCodeAt(0) - (char.charCodeAt(0) - 'A'.charCodeAt(0)));
                } else if (char >= 'a' && char <= 'z') {
                    result += String.fromCharCode('z'.charCodeAt(0) - (char.charCodeAt(0) - 'a'.charCodeAt(0)));
                } else if (char >= '0' && char <= '9') {
                    result += String.fromCharCode('9'.charCodeAt(0) - (char.charCodeAt(0) - '0'.charCodeAt(0)));
                } else {
                    result += char;
                }
            }
            return result;
        }

        function vigenereCipher(text, key, decrypt = false) {
            let result = '';
            key = key.toUpperCase();
            let keyIndex = 0;
            
            for (let char of text) {
                if (/[–∞-—è–ê-–Øa-zA-Z0-9]/.test(char)) {
                    let keyChar = key[keyIndex % key.length];
                    let shift = keyChar >= '–ê' && keyChar <= '–Ø' ? 
                              keyChar.charCodeAt(0) - '–ê'.charCodeAt(0) : 
                              keyChar.charCodeAt(0) - 'A'.charCodeAt(0);
                    
                    if (decrypt) shift = -shift;
                    
                    if (char >= '–ê' && char <= '–Ø') {
                        result += String.fromCharCode((char.charCodeAt(0) - '–ê'.charCodeAt(0) + shift + 32) % 32 + '–ê'.charCodeAt(0));
                    } else if (char >= '–∞' && char <= '—è') {
                        result += String.fromCharCode((char.charCodeAt(0) - '–∞'.charCodeAt(0) + shift + 32) % 32 + '–∞'.charCodeAt(0));
                    } else if (char >= 'A' && char <= 'Z') {
                        result += String.fromCharCode((char.charCodeAt(0) - 'A'.charCodeAt(0) + shift + 26) % 26 + 'A'.charCodeAt(0));
                    } else if (char >= 'a' && char <= 'z') {
                        result += String.fromCharCode((char.charCodeAt(0) - 'a'.charCodeAt(0) + shift + 26) % 26 + 'a'.charCodeAt(0));
                    } else if (char >= '0' && char <= '9') {
                        result += String.fromCharCode((char.charCodeAt(0) - '0'.charCodeAt(0) + shift + 10) % 10 + '0'.charCodeAt(0));
                    }
                    keyIndex++;
                } else {
                    result += char;
                }
            }
            return result;
        }

        function base64Encode(text) {
            return btoa(unescape(encodeURIComponent(text)));
        }

        function base64Decode(text) {
            try {
                return decodeURIComponent(escape(atob(text)));
            } catch {
                return '‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è';
            }
        }

        function encryptText() {
            const text = document.getElementById('input-text').value;
            if (!text) {
                showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!');
                return;
            }

            const key = document.getElementById('encrypt-key').value;
            let result = '';

            try {
                switch(currentMethod) {
                    case 'caesar':
                        const shift = parseInt(key);
                        if (!shift || shift < 1 || shift > 25) {
                            showToast('‚ùå –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 25');
                            return;
                        }
 result = caesarCipher(text, shift);
                    break;
                case 'atbash':
                    result = atbashCipher(text);
                    break;
                case 'vigenere':
                    if (!key) {
                        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                        return;
                    }
                    result = vigenereCipher(text, key);
                    break;
                case 'base64':
                    result = base64Encode(text);
                    break;
                case 'fernet':
                    if (!key) {
                        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                        return;
                    }
                    result = `FERNET:${key}:${base64Encode(text)}`;
                    break;
            }

            document.getElementById('result-text').textContent = result;
            document.getElementById('result-container').style.display = 'block';
            showToast('‚úÖ –¢–µ–∫—Å—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω!');
        } catch (error) {
            showToast('‚ùå –û—à–∏–±–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
        }
    }

    function decryptText() {
        const text = document.getElementById('input-text').value;
        if (!text) {
            showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç!');
            return;
        }

        const key = document.getElementById('encrypt-key').value;
        let result = '';

        try {
            switch(currentMethod) {
                case 'caesar':
                    const shift = parseInt(key);
                    if (!shift || shift < 1 || shift > 25) {
                        showToast('‚ùå –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç 1 –¥–æ 25');
                        return;
                    }
                    result = caesarCipher(text, shift, true);
                    break;
                case 'atbash':
                    result = atbashCipher(text);
                    break;
                case 'vigenere':
                    if (!key) {
                        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                        return;
                    }
                    result = vigenereCipher(text, key, true);
                    break;
                case 'base64':
                    result = base64Decode(text);
                    break;
                case 'fernet':
                    if (!key) {
                        showToast('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á!');
                        return;
                    }
                    if (text.startsWith('FERNET:')) {
                        const parts = text.split(':');
                        if (parts[1] === key) {
                            result = base64Decode(parts[2]);
                        } else {
                            showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á!');
                            return;
                        }
                    } else {
                        showToast('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç');
                        return;
                    }
                    break;
            }

            document.getElementById('result-text').textContent = result;
            document.getElementById('result-container').style.display = 'block';
            showToast('‚úÖ –¢–µ–∫—Å—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω!');
        } catch (error) {
            showToast('‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è');
        }
    }

    function copyResult() {
        const result = document.getElementById('result-text').textContent;
        navigator.clipboard.writeText(result);
        showToast('üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    }

    // Key Generator
    function generateKey() {
        const type = document.getElementById('key-type').value;
        let key = '';

        switch(type) {
            case 'numeric':
                key = Math.floor(Math.random() * 25) + 1;
                break;
            case 'word':
                const words = ['–°–ï–ö–†–ï–¢', '–ü–ê–†–û–õ–¨', '–ö–õ–Æ–ß', '–ó–ê–©–ò–¢–ê', 'CRYPTO', 'SECRET', 'GUARDIAN'];
                key = words[Math.floor(Math.random() * words.length)];
                break;
            case 'strong':
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                for (let i = 0; i < 16; i++) {
                    key += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                break;
        }

        document.getElementById('generated-key').textContent = key;
        document.getElementById('key-display').style.display = 'block';
        showToast('üé≤ –ö–ª—é—á —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω!');
    }

    function saveKey() {
        const key = document.getElementById('generated-key').textContent;
        const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª—é—á–∞:', '–ö–ª—é—á ' + (savedKeys.length + 1));
        
        if (name) {
            savedKeys.push({
                id: Date.now(),
                name: name,
                value: key,
                date: new Date().toLocaleDateString()
            });
            localStorage.setItem('cryptoKeys', JSON.stringify(savedKeys));
            showToast('üíæ –ö–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            loadSavedKeys();
        }
    }

    function copyKey() {
        const key = document.getElementById('generated-key').textContent;
        navigator.clipboard.writeText(key);
        showToast('üìã –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }

    function loadSavedKeys() {
        const container = document.getElementById('saved-keys');
        
        if (savedKeys.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-icon">üîë</div><div>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π</div></div>';
            return;
        }

        container.innerHTML = savedKeys.map(key => `
            <div class="key-item">
                <div class="key-info">
                    <div class="key-name">${key.name}</div>
                    <div class="key-value">${key.value}</div>
                </div>
                <div class="key-actions">
                    <button class="icon-btn" onclick="copyStoredKey('${key.value}')" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å">üìã</button>
                    <button class="icon-btn" onclick="deleteKey(${key.id})" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                </div>
            </div>
        `).join('');
    }

    function copyStoredKey(value) {
        navigator.clipboard.writeText(value);
        showToast('üìã –ö–ª—é—á —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
    }

    function deleteKey(id) {
        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–ª—é—á?')) {
            savedKeys = savedKeys.filter(k => k.id !== id);
            localStorage.setItem('cryptoKeys', JSON.stringify(savedKeys));
            loadSavedKeys();
            showToast('üóëÔ∏è –ö–ª—é—á —É–¥–∞–ª–µ–Ω');
        }
    }

    // Messages
    function sendMessage() {
        const recipientId = document.getElementById('recipient-id').value;
        const text = document.getElementById('message-text').value;

        if (!recipientId || !text) {
            showToast('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
            return;
        }

        const encrypted = base64Encode(text);
        
        messages.unshift({
            id: Date.now(),
            recipient: recipientId,
            text: encrypted,
            date: new Date().toLocaleString(),
            sent: true
        });

        localStorage.setItem('cryptoMessages', JSON.stringify(messages));
        
        document.getElementById('recipient-id').value = '';
        document.getElementById('message-text').value = '';
        
        showToast('üì§ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
        loadMessages();
    }

    function loadMessages() {
        const container = document.getElementById('messages-list');
        
        if (messages.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-icon">üí¨</div><div>–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div></div>';
            return;
        }

        container.innerHTML = messages.map(msg => `
            <div class="message-item">
                <div class="message-header">
                    <span>üì§ –ö–æ–º—É: ${msg.recipient}</span>
                    <span class="message-time">${msg.date}</span>
                </div>
                <div class="message-text">${msg.text}</div>
            </div>
        `).join('');
    }

    // Toast
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        
        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }

    // Initialize
    loadSavedKeys();
    loadMessages();
</script>

